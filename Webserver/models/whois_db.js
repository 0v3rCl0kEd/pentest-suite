var db = require("../db/db");

var WhoisSchema = new db.mongoose.Schema({
    domain: {
        type: String,
        unique: false
    },
    date: {
        type: Date
    },
    result: {
        type: String
    }
});

var WhoisResult = db.mongoose.model("whois", WhoisSchema);

const checkDatabase = async (domain) => {
    var result = await WhoisResult.find({domain: domain});
    if(result.length > 0) return result;
    return "Fetching...";
}

const retrieveData = async (domain) => {
    var result = await WhoisResult.find({domain: domain});
    if(result.length > 0) return result;
    fetch(`http://172.30.203.89:3000/scan/whois/${domain}`);
    return "Fetching...";
}

module.exports.checkDatabase = checkDatabase;
module.exports.retrieveData = retrieveData;