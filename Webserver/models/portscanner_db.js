var db = require("../db/db");

var PortScannerSchema = new db.mongoose.Schema({
    ip: {
        type: String,
        unique: false
    },
    date: {
        type: Date
    },
    openPorts: {
        type: Array
    }
});

var PortScannerResult = db.mongoose.model("portscanner", PortScannerSchema);

const checkDatabase = async (ip) => {
    var result = await PortScannerResult.find({ip: ip});
    if(result.length > 0) return result;
    return "Fetching...";
}

const retrieveData = async (ip) => {
    var result = await PortScannerResult.find({ip: ip});
    if(result.length > 0) return result;
    var res = await fetch(`http://172.30.203.89:3000/scan/portscanner/${ip}`);
    
    if(res.status == 400) return "Bad ip...";
    return "Fetching...";

}

module.exports.retrieveData = retrieveData;
module.exports.checkDatabase = checkDatabase;