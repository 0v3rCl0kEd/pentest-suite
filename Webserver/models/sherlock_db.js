var db = require("../db/db");

var SherlockSchema = new db.mongoose.Schema({
    username: {
        type: String,
        unique: false
    },
    date: {
        type: Date
    },
    results: {
        type: Array
    }
});

var SherlockResult = db.mongoose.model("sherlock", SherlockSchema);

const checkDatabase = async (username) => {
    var result = await SherlockResult.find({username: username});
    if(result.length > 0) return result;
    return "Fetching...";
}

const retrieveData = async (username) => {
    var result = await SherlockResult.find({username: username});
    if(result.length > 0) return result;
    // apeleaza api
    fetch(`http://172.30.203.89:3000/scan/sherlock/${username}`);
    return "Fetching..."
}

module.exports.retrieveData = retrieveData;
module.exports.SherlockResult = SherlockResult;
module.exports.checkDatabase = checkDatabase;
