$(document).ready(() => {
    handleForm();
});

const handleForm = () => {
    $("#search-form").submit((e) => {
        e.preventDefault();
        const data = $("#search").val();

        $.ajax({
            url: `/sherlock/retrieve_user/${data}`,
            type: "get",
            success: (data) => {
                console.log(data);
                buildTable(data);
            },
            statusCode: {
                420: () => {
                    $("#response").text("Fetching...");
                    const cancel = setInterval(() => {
                        $.ajax({
                            url: `/sherlock/check_user/${data}`,
                            type: "get",
                            success: (data) => {
                                console.log(data);
                                buildTable(data);
                                clearInterval(cancel);
                            },
                        });
                    }, 1000)
                }
            }
        });
    });
};

const buildTable = (data) => {
    // $("#response").html(`<p>${data[data.length - 1]}</p>`);

    let html = `<table class="table"><thead><tr><th scope="col">#</th><th scope="col">Platform</th><th scope="col">Exists</th></tr></thead><tbody>`;
    data[data.length - 1].forEach(element => {
        
    });

    for (let i = 0; i < data[data.length - 1].results.length; i++) {
        const element = data[data.length - 1].results[i];
        
        html += `<tr><td>${i}</td><td>${element.name}</td><td>${element.available}</td></tr>`;
    }

    html += "</tbody></table>";

    $("#response").html(html);
};