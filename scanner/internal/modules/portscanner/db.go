package portscanner

import (
	"context"
	"fmt"
	"github.com/0v3rCl0kEd/pentest-suite/scanner/internal/db"
	"go.mongodb.org/mongo-driver/mongo"
	"time"
)

var (
	DB              *mongo.Database
	scansCollection *mongo.Collection
	dbCtx           context.Context
)

func SetupDB() {
	DB = db.GetDB()
	dbCtx = context.TODO()
	scansCollection = DB.Collection("portscanner")
}

func SaveResults(res []int, ip string) {
	if len(res) == 0 {
		return
	}

	scan := &Scan{
		IP:        ip,
		Date:      time.Now(),
		OpenPorts: res,
	}

	insertResult, err := scansCollection.InsertOne(dbCtx, scan)
	if err != nil {
		panic(err)
	}

	fmt.Println(insertResult.InsertedID)
}
